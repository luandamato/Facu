<!DOCTYPE html>
<!-- saved from url=(0069)https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming -->
<html lang="pt" dir="ltr" class="js desktop translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>Guia do desenvolvedor: programação do driver [Wiki]</title>
    <script async="" src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/analytics.js.download"></script><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki">
<meta name="robots" content="index,follow">
<meta name="keywords" content="developersguide,driverprogramming">
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.minix3.org/lib/exe/opensearch.php" title="Wiki">
<link rel="start" href="https://wiki.minix3.org/">
<link rel="contents" href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=index" title="Mapa do site">
<link rel="manifest" href="https://wiki.minix3.org/lib/exe/manifest.php">
<link rel="alternate" type="application/rss+xml" title="Mudanças recentes" href="https://wiki.minix3.org/feed.php">
<link rel="alternate" type="application/rss+xml" title="Namespace atual" href="https://wiki.minix3.org/feed.php?mode=list&amp;ns=developersguide">
<link rel="alternate" type="text/html" title="HTML simples" href="https://wiki.minix3.org/doku.php?do=export_xhtml&amp;id=developersguide:driverprogramming">
<link rel="alternate" type="text/plain" title="Marcação da Wiki" href="https://wiki.minix3.org/doku.php?do=export_raw&amp;id=developersguide:driverprogramming">
<link rel="canonical" href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming">
<link rel="stylesheet" type="text/css" href="./Guia do desenvolvedor_ programação do driver [Wiki]_files/css.php">
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='developersguide';var JSINFO = {"move_renameokay":false,"id":"developersguide:driverprogramming","namespace":"developersguide","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/jquery.php"></script>
<script type="text/javascript" charset="utf-8" src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/js.php"></script><style id="iris-css">.iris-picker{display:block;position:relative}.iris-picker,.iris-picker *{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input+.iris-picker{margin-top:4px}.iris-error{background-color:#ffafaf}.iris-border{border-radius:3px;border:1px solid #aaa;width:200px;background-color:#fff}.iris-picker-inner{position:absolute;top:0;right:0;left:0;bottom:0}.iris-border .iris-picker-inner{top:10px;right:10px;left:10px;bottom:10px}.iris-picker .iris-square-inner{position:absolute;left:0;right:0;top:0;bottom:0}.iris-picker .iris-square,.iris-picker .iris-slider,.iris-picker .iris-square-inner,.iris-picker .iris-palette{border-radius:3px;box-shadow:inset 0 0 5px rgba(0,0,0,.4);height:100%;width:12.5%;float:left;margin-right:5%}.iris-picker .iris-square{width:76%;margin-right:10%;position:relative}.iris-picker .iris-square-inner{width:auto;margin:0}.iris-ie-9 .iris-square,.iris-ie-9 .iris-slider,.iris-ie-9 .iris-square-inner,.iris-ie-9 .iris-palette{box-shadow:none;border-radius:0}.iris-ie-9 .iris-square,.iris-ie-9 .iris-slider,.iris-ie-9 .iris-palette{outline:1px solid rgba(0,0,0,.1)}.iris-ie-lt9 .iris-square,.iris-ie-lt9 .iris-slider,.iris-ie-lt9 .iris-square-inner,.iris-ie-lt9 .iris-palette{outline:1px solid #aaa}.iris-ie-lt9 .iris-square .ui-slider-handle{outline:1px solid #aaa;background-color:#fff;-ms-filter:"alpha(Opacity=30)"}.iris-ie-lt9 .iris-square .iris-square-handle{background:0;border:3px solid #fff;-ms-filter:"alpha(Opacity=50)"}.iris-picker .iris-strip{margin-right:0;position:relative}.iris-picker .iris-strip .ui-slider-handle{position:absolute;background:0;margin:0;right:-3px;left:-3px;border:4px solid #aaa;border-width:4px 3px;width:auto;height:6px;border-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,.2);opacity:.9;z-index:5;cursor:ns-resize}.iris-strip .ui-slider-handle:before{content:" ";position:absolute;left:-2px;right:-2px;top:-3px;bottom:-3px;border:2px solid #fff;border-radius:3px}.iris-picker .iris-slider-offset{position:absolute;top:11px;left:0;right:0;bottom:-3px;width:auto;height:auto;background:transparent;border:0;border-radius:0}.iris-picker .iris-square-handle{background:transparent;border:5px solid #aaa;border-radius:50%;border-color:rgba(128,128,128,.5);box-shadow:none;width:12px;height:12px;position:absolute;left:-10px;top:-10px;cursor:move;opacity:1;z-index:10}.iris-picker .ui-state-focus .iris-square-handle{opacity:.8}.iris-picker .iris-square-handle:hover{border-color:#999}.iris-picker .iris-square-value:focus .iris-square-handle{box-shadow:0 0 2px rgba(0,0,0,.75);opacity:.8}.iris-picker .iris-square-handle:hover::after{border-color:#fff}.iris-picker .iris-square-handle::after{position:absolute;bottom:-4px;right:-4px;left:-4px;top:-4px;border:3px solid #f9f9f9;border-color:rgba(255,255,255,.8);border-radius:50%;content:" "}.iris-picker .iris-square-value{width:8px;height:8px;position:absolute}.iris-ie-lt9 .iris-square-value,.iris-mozilla .iris-square-value{width:1px;height:1px}.iris-palette-container{position:absolute;bottom:0;left:0;margin:0;padding:0}.iris-border .iris-palette-container{left:10px;bottom:10px}.iris-picker .iris-palette{margin:0;cursor:pointer}.iris-square-handle,.ui-slider-handle{border:0;outline:0}</style>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="shortcut icon" href="https://wiki.minix3.org/lib/tpl/minix3d/images/favicon.ico">
<link rel="apple-touch-icon" href="https://wiki.minix3.org/lib/tpl/minix3d/images/apple-touch-icon.png">
    <link type="text/css" rel="stylesheet" charset="UTF-8" href="./Guia do desenvolvedor_ programação do driver [Wiki]_files/translateelement.css"></head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_minix3d     ">

        <!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    	<div id="header">
		<a href="http://www.minix3.org/" id="logo"></a>
		<div id="nav">
			<ul>
				<li class="first"><a href="http://www.minix3.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CASA</font></font></a></li>
				<li><a href="https://wiki.minix3.org/doku.php?id=www:getting-started:"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMEÇANDO</font></font></a></li>
				<li><a href="https://wiki.minix3.org/doku.php?id=www:download:"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BAIXAR</font></font></a></li>
				<li><a href="https://wiki.minix3.org/doku.php?id=www:documentation:"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOCUMENTAÇÃO</font></font></a></li>
				<li><a href="https://wiki.minix3.org/doku.php?id=www:community:"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMUNIDADE</font></font></a></li>
				<li><a href="https://blog.minix3.org/tag/news/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOTÍCIA</font></font></a></li>
				<li class="last active"><a href="https://wiki.minix3.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WIKI</font></font></a></li>
			</ul>
		</div>
	</div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas do usuário</font></font></h3>
                <ul>
                    <li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=login&amp;sectok=" class="action login" rel="nofollow" title="Conecte-se"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte-se</font></font></a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas do site</font></font></h3>
            <form action="https://wiki.minix3.org/doku.php?id=start" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search"><input type="hidden" name="id" value="developersguide:driverprogramming"><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Procurar" autocomplete="on" id="qsearch__in" value=""><button value="1" type="submit" title="Procurar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Procurar</font></font></button><div id="qsearch__out" class="ajax_qsearch JSpopup" style="display: none;"></div></div></form>            <div class="mobileTools">
                <form action="https://wiki.minix3.org/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="developersguide:driverprogramming"><select name="do" class="edit quickselect" title="Ferramentas"><option value=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas</font></font></option><optgroup label="Page Tools"><option value="edit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar fonte da página</font></font></option><option value="revisions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revisões antigas</font></font></option><option value="copypageplugin__copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copie esta página</font></font></option><option value="backlink"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backlinks</font></font></option></optgroup><optgroup label="Site Tools"><option value="recent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mudanças recentes</font></font></option><option value="media"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerente de mídia</font></font></option><option value="index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapa do site</font></font></option></optgroup><optgroup label="User Tools"><option value="login"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte-se</font></font></option></optgroup></select><button type="submit" style="display: none;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font></button></div></form>            </div>
            <ul>
                <li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=recent" class="action recent" accesskey="r" rel="nofollow" title="Mudanças recentes [R]"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mudanças recentes</font></font></a></li><li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=media&amp;ns=developersguide" class="action media" rel="nofollow" title="Gerente de mídia"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerente de mídia</font></font></a></li><li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=index" class="action index" accesskey="x" rel="nofollow" title="Mapa do site [X]"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapa do site</font></font></a></li>            </ul>
        </div>

    </div>

    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#dokuwiki__content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir para o conteúdo</font></font></a></li>
        </ul>

            </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você está aqui: </font></font></span><span class="home"><bdi><a href="https://wiki.minix3.org/doku.php?id=start" class="wikilink1" title="começar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">começar</font></font></a></bdi></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » </font></font><bdi><a href="https://wiki.minix3.org/doku.php?id=developersguide:start" class="wikilink1" title="developersguide: start"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guia do desenvolvedor</font></font></a></bdi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » </font></font><bdi><span class="curid"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming" class="wikilink1" title="developersguide: driverprogramming"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driverprogramming</font></font></a></span></bdi></div>
                                </div>
    


    <hr class="a11y">
</div></div><!-- /header -->


        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developersguide: driverprogramming</font></font></span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;"><strong><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Índice</font></font></h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li class="level1"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#programming_device_drivers_in_minix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programação de drivers de dispositivo no Minix</font></font></a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#introduction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdução</font></font></a></div></li>
<li class="level2"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#requirements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exigências</font></font></a></div></li>
<li class="level2"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#getting_started"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Começando</font></font></a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#example_1hello_world"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 1: Olá, mundo</font></font></a></div></li>
<li class="level3"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#example_2dev_hello"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 2: / dev / hello</font></font></a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#device_drivers_in_the_real_world"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drivers de dispositivo no mundo real</font></font></a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#example_3cmos_system_clock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 3: Relógio do sistema CMOS</font></font></a></div></li>
<li class="level3"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#example_4rs232_serial_port"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 4: Porta serial RS232</font></font></a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#feedback"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentários</font></font></a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="programming_device_drivers_in_minix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programação de drivers de dispositivo no Minix</font></font></h1>
<div class="level1">

</div>

<h2 class="sectionedit2" id="introduction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdução</font></font></h2>
<div class="level2">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este tutorial ajuda você a começar a programar drivers de dispositivo no Minix em C. Um driver de dispositivo é um programa de computador que interage com componentes de hardware reais. </font><font style="vertical-align: inherit;">Por exemplo, o computador que você usa agora para ler esta página da Web possui um driver de dispositivo para o monitor. </font><font style="vertical-align: inherit;">Outro exemplo é o driver de disco, que lê e grava dados brutos do (s) disco (s) no seu computador. </font><font style="vertical-align: inherit;">Claramente, os sistemas de computador seriam inúteis sem bons drivers de dispositivo.
</font></font></p>

</div>

<h2 class="sectionedit3" id="requirements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exigências</font></font></h2>
<div class="level2">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O desenvolvimento de um driver de dispositivo requer habilidades de programação e conhecimento do (s) dispositivo (s) de destino. </font><font style="vertical-align: inherit;">No Minix, os drivers de dispositivo são programados no idioma C. </font><font style="vertical-align: inherit;">Neste tutorial, assumimos que você conhece o básico da linguagem de programação C e que possui um sistema Minix em funcionamento,&gt; versão 3.2.1.
</font></font></p>

</div>

<h2 class="sectionedit4" id="getting_started"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Começando</font></font></h2>
<div class="level2">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As seções a seguir contêm instruções passo a passo para experimentar a programação de drivers de dispositivo simples.
</font></font></p>

<p>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que, embora esta página esteja um pouco desatualizada, uma versão atualizada do driver hello faz parte da árvore de origem do MINIX3. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você pode encontrá-lo em / usr / src / minix / drivers / examples / hello. </font><font style="vertical-align: inherit;">O restante deste documento pressupõe que o driver ainda não está lá e o guiará pelas etapas para criar você mesmo. </font><font style="vertical-align: inherit;">O exemplo 1 mostra como configurar a infraestrutura e criar um processo de driver de trabalho muito básico. </font><font style="vertical-align: inherit;">O exemplo 2 o estende para um driver de caractere simples. </font><font style="vertical-align: inherit;">O hello.c da árvore de origem do MINIX3 corresponde ao segundo exemplo.
</font></font></p>

</div>

<h3 class="sectionedit5" id="example_1hello_world"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 1: Olá, mundo</font></font></h3>
<div class="level3">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar o driver mais simples possível primeiro - o driver de dispositivo Hello World. </font><font style="vertical-align: inherit;">Ele tem apenas uma tarefa: imprimir uma mensagem de saudação na inicialização e terminar.</font></font><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/icon_smile.gif" class="icon" alt=":-)">
</p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, crie um diretório na árvore de origem do Minix para colocar o código-fonte do nosso driver. </font><font style="vertical-align: inherit;">Como root, execute:
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cd / usr / src / minix / drivers / examples </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># mkdir hello </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cd hello</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para compilar o driver do dispositivo, precisamos de um </font></font><a href="http://en.wikipedia.org/wiki/Make_(software)" class="urlextern" title="http://en.wikipedia.org/wiki/Make_(software)" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Você pode usar o seguinte código como seu Makefile para compilar o driver:
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code make"><span class="co1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Makefile para o driver hello. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PROG </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    olá</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SRCS </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    Olá </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ARQUIVOS </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= $ </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span><span class="re2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROG </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FILESNAME </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= $ </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span><span class="re2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROG </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
FILESDIR </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> etc </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> system </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DPADD </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ = </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span><span class="re2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIBCHARDRIVER </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span><span class="re2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIBSYS </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
LDADD </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ = </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lchardriver </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lsys</font></font><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAN </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font></font>
&nbsp;<font></font>
<span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclua </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> minix </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serviço </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mk </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, crie um arquivo de programa C com o programa hello world:
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.c</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code c"><span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdlib.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;minix / syslib.h&gt;</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> main </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> argc </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">**</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> argv </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Olá, mundo! </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EXIT_SUCCESS</font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ignore a chamada sef_startup () por enquanto. </font><font style="vertical-align: inherit;">Explicaremos seu objetivo mais adiante. </font><font style="vertical-align: inherit;">Agora tente ver se tudo compila corretamente:
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fazer limpeza </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fazer </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fazer instalar</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você não recebeu nenhum erro, é hora de tentar executar o driver do dispositivo. </font><font style="vertical-align: inherit;">Antes de fazer isso, devemos criar o </font><font style="vertical-align: inherit;">arquivo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.conf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele contém as permissões para o serviço. </font><font style="vertical-align: inherit;">Normalmente, cada driver de dispositivo precisa acessar apenas um dispositivo de hardware real e usa algumas funções fornecidas pelo Minix. </font><font style="vertical-align: inherit;">Para dar ao nosso simples driver de teste hello permissões suficientes para experimentar, crie </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.conf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com:
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.conf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">olá serviço</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        sistema</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                UMAP # 14</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                IRQCTL # 19</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DEVIO # 21</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ipc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                SISTEMA PM RS LOG TTY DS VM VFS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                pci inet amddev</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    uid 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
};</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É necessário iniciar, parar e reiniciar os drivers de dispositivo usando o </font><font style="vertical-align: inherit;">comando </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minix-service (8)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para iniciar o programa hello, digite o seguinte comando:
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># minix-service up / service / olá</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Olá, mundo </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RS: reiniciando </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> service </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello, reinicia </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E que surpresa, exibe o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olá, Mundo! </font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mensagem </font></font><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/icon_smile.gif" class="icon" alt=":-)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no log do kernel. </font><font style="vertical-align: inherit;">Verifique com a escrita do conteúdo de / var / log / messages. </font><font style="vertical-align: inherit;">Pare o driver com:
</font></font></p>
<pre class="code bash"><span class="co4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> minix-service down olá</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também recebemos outra mensagem do chamado </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reincarnation Server</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (RS). </font><font style="vertical-align: inherit;">No Minix como </font></font><a href="http://en.wikipedia.org/wiki/Microkernel" class="urlextern" title="http://en.wikipedia.org/wiki/Microkernel" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microkernel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , drivers de dispositivo são programas separados que enviam e recebem mensagens para se comunicar com os outros componentes do sistema operacional. </font><font style="vertical-align: inherit;">Os drivers de dispositivo, como qualquer outro programa, podem conter bugs e podem falhar a qualquer momento. </font><font style="vertical-align: inherit;">O servidor de reencarnação tentará reiniciar os drivers de dispositivo quando perceber que eles foram mortos abruptamente pelo kernel devido a uma falha ou, no nosso caso, quando eles saem inesperadamente (2). </font><font style="vertical-align: inherit;">Você pode ver o Reincarnation Server na lista de processos como </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se você usar o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps (1)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando. </font><font style="vertical-align: inherit;">O Reincarnation Server envia mensagens de manutenção para cada driver de dispositivo em execução no sistema periodicamente, para garantir que eles ainda sejam responsáveis ​​e não sejam presos em um loop infinito.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, como lidamos com isso? </font><font style="vertical-align: inherit;">Deixamos o nosso driver hello responder às mensagens de manutenção, para que o RS detecte corretamente que ainda está em execução. </font><font style="vertical-align: inherit;">Felizmente, como veremos no próximo exemplo, existe uma biblioteca </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libchardriver</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no Minix. </font><font style="vertical-align: inherit;">Esta biblioteca cuida de várias tarefas comuns a todos os drivers de caracteres. </font><font style="vertical-align: inherit;">Por exemplo, ele realiza a comunicação com o Reincarnation Server e os componentes do sistema operacional de forma transparente.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por outro lado, uma funcionalidade diretamente exposta ao desenvolvedor do driver de dispositivo é o protocolo de inicialização. </font><font style="vertical-align: inherit;">Quando um novo driver de dispositivo (ou qualquer outro serviço do sistema) é iniciado, o RS envia ao driver uma mensagem de inicialização com informações sobre como inicializar corretamente. </font><font style="vertical-align: inherit;">Espera-se que o driver responda com OK (inicialização concluída com sucesso) ou com um erro (falha na inicialização). </font><font style="vertical-align: inherit;">No primeiro caso, o RS assumirá que o novo driver de dispositivo foi iniciado corretamente. </font><font style="vertical-align: inherit;">Neste último caso, o RS desligará imediatamente o driver sem tentar reiniciá-lo. </font><font style="vertical-align: inherit;">O usuário será informado com uma mensagem no console. </font><font style="vertical-align: inherit;">Felizmente, o protocolo de inicialização está completamente oculto no </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System Event Framework (SEF)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que expõe as chamadas da biblioteca para permitir que os desenvolvedores lidem com a inicialização de maneira fácil e eficaz.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No início do código em main (), o desenvolvedor precisa registrar um ou mais retornos de chamada de inicialização e deixar o </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fazer o resto chamando </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_startup ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta é a razão pela qual </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inserimos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma chamada para </font><em><font style="vertical-align: inherit;">sef_startup ()</font></em><font style="vertical-align: inherit;"> no código acima. </font><font style="vertical-align: inherit;">Cada retorno de chamada é apenas uma função que recebe dados de inicialização como entrada e retorna um código de status para determinar o resultado do processo de inicialização. </font><font style="vertical-align: inherit;">A partir de agora, os desenvolvedores podem registrar retornos de chamada para três tipos de inicialização: </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (quando um serviço é iniciado pela primeira vez), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atualização ao vivo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (quando um serviço é atualizado dinamicamente para uma nova versão), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reiniciado</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (quando um serviço é reiniciado após um falha ou reinicialização controlada).
</font></font></p>

</div>

<h3 class="sectionedit6" id="example_2dev_hello"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 2: / dev / hello</font></font></h3>
<div class="level3">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste exemplo, estenderemos o driver hello e o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reimplementaremos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o </font><em><font style="vertical-align: inherit;">libchardriver</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Em vez de apenas imprimir um hello na inicialização, agora queremos usar um arquivo de dispositivo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / hello</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ler a mensagem Hello World. </font><font style="vertical-align: inherit;">Cada caractere e driver de bloco está associado a um </font><font style="vertical-align: inherit;">número de dispositivo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Portanto, precisamos escolher um número de dispositivo principal gratuito para o dispositivo - um que ainda não esteja sendo usado por outro driver de dispositivo. </font><font style="vertical-align: inherit;">Usaremos a ID principal 17 neste exemplo, que é atribuída ao driver hello como está (consulte </font></font><code>minix/dmap.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Começamos criando o arquivo / dev / hello:
</font></font></p>
<pre class="code bash"><span class="co4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font></span><span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mknod </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dev </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello c </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17 </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando cria um </font><font style="vertical-align: inherit;">dispositivo </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> haracter com número principal 17 e número menor 0 (o número menor não é importante para o driver hello), chamado / dev / hello.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode reutilizar o Makefile do Exemplo 1. Agora crie o </font><font style="vertical-align: inherit;">arquivo de cabeçalho </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.h</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.h</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code c"><span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#ifndef __HELLO_H </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define __HELLO_H</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ** Olá, mundo! </font><font style="vertical-align: inherit;">mensagem. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define HELLO_MESSAGE "Olá, mundo! \ n"</font></font></span><font></font>
&nbsp;<font></font>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endif / * __HELLO_H * /</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver, ele contém uma macro de pré-processador para a mensagem. </font><font style="vertical-align: inherit;">Agora coloque esse código-fonte no </font><font style="vertical-align: inherit;">arquivo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.c</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.c</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code c"><span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;minix / drivers.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;minix / chardriver.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdlib.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;minix / ds.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include "hello.h"</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 * Protótipos de funções para o driver hello.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 * / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_open </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> access </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpoint_t user_endpt </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_close </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssize_t </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estático</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_read </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição u64_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpoint_t endpt </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    cp_grant_id_t grant </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> size </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sinalizadores </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdev_id_t id </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Funções e variáveis ​​SEF. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_local_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_init_info_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_lu_state_save </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lu_state_restore </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Pontos de entrada para o driver hello. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estático </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chardriver hello_tab </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    . </font></font><span class="me1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdr_open </font></font></span>	<span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_open </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    . </font></font><span class="me1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdr_close </font></font></span>	<span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_close </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    . </font></font><span class="me1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdr_read </font></font></span>	<span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_read </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ** Variável de estado para contar o número de vezes que o dispositivo foi aberto.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 * Observe que esse não é o tipo comum de contador aberto: nunca diminui.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 * / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> open_counter </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_open </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acesso </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    endpoint_t UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> user_endpt </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello_open (). Chamado% d hora (s). </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">++</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> open_counter </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_close </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> secundário </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello_close () </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssize_t </font><span class="kw4"><font style="vertical-align: inherit;">estático</font></span><font style="vertical-align: inherit;"> hello_read </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição u64_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    endpoint_t endpt </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> concessão cp_grant_id_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> size </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sinalizadores </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    cdev_id_t UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> id </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    u64_t dev_size </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ptr </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ret </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buf </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HELLO_MESSAGE </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello_read () </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Esse é o tamanho total do nosso dispositivo. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    dev_size </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> u64_t </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buf </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Verifique o EOF e, possivelmente, limite o tamanho da leitura. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> position </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; =</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dev_size </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>		<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * EOF * / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho_dev </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        tamanho </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamanho_t </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho_dev </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>	<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * tamanho limite * /</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Copie a parte solicitada para o chamador. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    Ptr </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buf </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ret </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sys_safecopyto </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpt </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grant </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vir_bytes </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ptr </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!! =</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
        <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ret </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Retorna o número de bytes lidos. </font><font style="vertical-align: inherit;">* /</font></font></span>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho de </font></font><span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorno </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_lu_state_save </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estado </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sinalizadores </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Salve o estado. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    ds_publish_u32 </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"open_counter" </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> open_counter </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DSF_OVERWRITE </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lu_state_restore </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Restaura o estado. </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    valor </font><span class="coMULTI"><font style="vertical-align: inherit;">* /</font></span><font style="vertical-align: inherit;"> u32_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ds_retrieve_u32 </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"open_counter" </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ds_delete_u32 </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"open_counter" </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    open_counter </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_local_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * Registre retornos de chamada init. </font><font style="vertical-align: inherit;">Use a mesma função para todos os tipos de eventos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_setcb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    sef_setcb_init_lu </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    sef_setcb_init_restart </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * Registre retornos de chamada de atualização ao vivo.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_setcb_lu_state_save </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_lu_state_save </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Deixe o SEF executar a inicialização. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_init_info_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UNUSED </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Inicialize o driver hello. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do_announce_driver </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TRUE </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    open_counter </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
        <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">case</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SEF_INIT_FRESH </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font></span>
            <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"% s" </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HELLO_MESSAGE </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
        <span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quebrar </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
        <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">case</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SEF_INIT_LU </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font></span>
            <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Restaure o estado. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            lu_state_restore </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            do_announce_driver </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FALSO </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
            <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"% sEi, sou uma nova versão! </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HELLO_MESSAGE</font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
        <span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quebrar </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
        <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">case</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SEF_INIT_RESTART </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font></span>
            <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"% sHey, acabei de reiniciar! </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HELLO_MESSAGE </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
        <span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quebrar </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Anuncie que estamos acordados quando necessário. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do_announce_driver </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        chardriver_announce </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Inicialização concluída com sucesso. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> main </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vazio </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * Execute a inicialização.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_local_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * Execute o loop principal.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    chardriver_task </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_tab </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar entender o que o código acima faz. </font><font style="vertical-align: inherit;">Primeiro, ele possui várias linhas #include para os protótipos e funções necessários usados ​​no programa. </font><font style="vertical-align: inherit;">Em seguida, declara um </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chardriver struct</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Essa estrutura é preenchida com </font><font style="vertical-align: inherit;">funções de </font></font><a href="http://en.wikipedia.org/wiki/Callback_(computer_science)" class="urlextern" title="http://en.wikipedia.org/wiki/Callback_(computer_science)" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorno de chamada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que serão chamadas pelo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libchardriver</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no tempo de execução. </font><font style="vertical-align: inherit;">Possui funções de retorno de chamada para executar operações de abertura, leitura, gravação e fechamento no driver do dispositivo. </font><font style="vertical-align: inherit;">A maior parte da ação acontece na </font><font style="vertical-align: inherit;">função </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello_read</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele usou o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_safecopyto</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para copiar a string HELLO_MESSAGE do programa de driver de dispositivo para o programa de usuário lendo em / dev / hello. </font><font style="vertical-align: inherit;">O sistema operacional irá, em nome do driver do dispositivo, copiar adequadamente os bytes entre os dois programas. </font><font style="vertical-align: inherit;">Um vetor </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iov de</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entrada / saída </font><font style="vertical-align: inherit;">é usado pela </font><font style="vertical-align: inherit;">função </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_safecopyto</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para descrever o endereço de memória para armazenar bytes e o número de bytes solicitados pelo aplicativo do usuário.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na função </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , existem apenas duas chamadas simples. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_local_startup ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é chamado no início para registrar </font><font style="vertical-align: inherit;">retornos de chamada </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e concluir a inicialização. </font><font style="vertical-align: inherit;">Em </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_local_startup (),</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a mesma função </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_cb_init_fresh ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é registrada como retorno de chamada para todos os tipos de inicialização suportados. </font><font style="vertical-align: inherit;">Isso significa que o código de inicialização executado quando o driver é iniciado será sempre o mesmo, independentemente do driver do dispositivo ter sido iniciado novamente, após uma atualização ao vivo ou após uma reinicialização.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_local_startup ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , também registramos retornos de chamada para eventos de atualização ao vivo. </font><font style="vertical-align: inherit;">Um evento de atualização ao vivo é acionado pelo RS quando uma nova versão de um serviço do sistema está disponível. </font><font style="vertical-align: inherit;">Nesse ponto, o RS envia uma mensagem para a versão antiga do serviço solicitando a preparação para um estado específico, conforme exigido pela atualização. </font><font style="vertical-align: inherit;">O serviço decidirá se aceita o estado de atualização solicitado ou rejeita a atualização caso contrário. </font><font style="vertical-align: inherit;">No primeiro caso, o serviço se compromete a se preparar para a atualização e responder de volta ao RS quando o estado de destino for atingido. </font><font style="vertical-align: inherit;">Somente nesse ponto, o RS instala a atualização e a nova versão pode ser inicializada a partir do estado em que a versão antiga parou. </font><font style="vertical-align: inherit;">Felizmente, o protocolo de atualização ao vivo está oculto no </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System Event Framework</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o desenvolvedor do driver não precisa se preocupar com todos os detalhes. </font><font style="vertical-align: inherit;">Para dar suporte à atualização ao vivo de um serviço do sistema, o desenvolvedor deve registrar apenas retornos de chamada para informar ao </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o que fazer quando uma solicitação de atualização ao vivo aparecer. </font><font style="vertical-align: inherit;">Os tipos de retorno de chamada mais importantes para atualização ao vivo são </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state_isvalid</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prepare</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Um </font><font style="vertical-align: inherit;">retorno de chamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state_isvalid</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deve ser registrado para informar ao </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quais estados de atualização devem ser aceitos. </font><font style="vertical-align: inherit;">Por </font><font style="vertical-align: inherit;">outro lado, </font><font style="vertical-align: inherit;">um </font><font style="vertical-align: inherit;">retorno de chamada de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preparação</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é chamado toda vez que um serviço do sistema tem a chance de se preparar para atualizar (após a aceitação de uma solicitação de atualização). </font><font style="vertical-align: inherit;">O retorno de chamada deve tomar o estado de destino como entrada e retornar OK apenas se o serviço estiver pronto para a atualização solicitada.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O driver hello é completamente sem estado e podemos suportar atualizações ao vivo a partir de qualquer estado e permitir que o RS realize a atualização na primeira chance possível. </font><font style="vertical-align: inherit;">Para fazer isso, registramos duas implementações de retorno de chamada predefinidas para o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state_isvalid</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preparamos os</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipos de retorno de chamada. </font><font style="vertical-align: inherit;">Essas são as funções de biblioteca implementadas na </font><font style="vertical-align: inherit;">estrutura </font></font><a href="https://wiki.minix3.org/doku.php?id=developersguide:sef" class="wikilink1" title="developersguide: sef"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF </font></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_cb_lu_state_isvalid_standard</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_cb_lu_prepare_always_ready</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , respectivamente. </font><font style="vertical-align: inherit;">O retorno de chamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_cb_lu_state_isvalid_standard</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aceita qualquer estado de atualização ao vivo padrão e o retorno de chamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sef_cb_lu_prepare_always_ready</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sempre informa que o serviço está pronto para ser atualizado. </font><font style="vertical-align: inherit;">Quando o driver do dispositivo não é sem estado, o desenvolvedor deve fornecer implementações apropriadas para esses dois tipos de retorno de chamada para dar suporte aos estados padrão e possivelmente a outros estados personalizados definidos para o driver. </font><font style="vertical-align: inherit;">Os estados padrão atualmente definidos são </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF_LU_STATE_WORK_FREE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o serviço não está executando nenhum trabalho), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF_LU_STATE_REQUEST_FREE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o serviço não possui solicitação pendente), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEF_LU_STATE_PROTOCOL_FREE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o serviço não está envolvido em um protocolo).
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, a </font><font style="vertical-align: inherit;">função </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> executa </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chardriver_task ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para permitir que o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libchardriver</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comece a processar solicitações do usuário e invoque nossas funções de retorno de chamada do driver.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora compile o programa novamente usando os mesmos comandos do exemplo 1 e inicie o driver com o </font><font style="vertical-align: inherit;">comando </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service (8)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Fornecemos </font></font><code>-dev /dev/hello</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para indicar que o driver recém-iniciado é responsável pelo principal dispositivo identificado por / dev / hello - ou seja, o principal 17, que escolhemos anteriormente.
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service up / usr / sbin / hello -dev / dev / hello</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Olá, mundo </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingo! </font><font style="vertical-align: inherit;">Não é mais necessário reiniciar a partir do Reincarnation Server. </font><font style="vertical-align: inherit;">Agora tente ver se conseguimos ler a mensagem Hello World usando um arquivo de dispositivo.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos simplesmente usar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat (1)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ler a partir do dispositivo hello:
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cat / dev / hello</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
hello_open </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
hello_read </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
hello_read </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
hello_close </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Olá, mundo </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você receber a mensagem acima, o driver hello funciona! </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: D</font></font></strong>
</p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos tentar reiniciar o driver com o </font><font style="vertical-align: inherit;">comando </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service (8)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para simular uma falha:
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Atualização serviço Olá</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Olá, mundo </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ei, </font></font><span class="st_h"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acabei de reiniciar!</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
# cat / dev / olá</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_open ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_read ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_read ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_close ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olá Mundo!</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, vamos tentar com uma atualização ao vivo. </font><font style="vertical-align: inherit;">Faça a seguinte alteração no </font><font style="vertical-align: inherit;">arquivo de cabeçalho </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.h</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello.h</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code c"><span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#ifndef __HELLO_H </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define __HELLO_H</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ** Olá, mundo! </font><font style="vertical-align: inherit;">mensagem. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define HELLO_MESSAGE "Olá, Novo Mundo! \ n"</font></font></span><font></font>
&nbsp;<font></font>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endif / * __HELLO_H * /</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora recompile e atualize o driver com o </font><font style="vertical-align: inherit;">comando </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service (8)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># make clean </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># make </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># make install </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service update / service / hello -state 1 # solicite um estado de atualização em que nenhum trabalho esteja em andamento (por exemplo, SEF_LU_STATE_WORK_FREE = 1)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Olá, Novo Mundo </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ei, eu </font></font><span class="st_h"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sou uma nova versão!</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
# cat / dev / olá</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_open ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_read ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_read ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hello_close ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olá, Novo Mundo!</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como esperado, o driver é atualizado ao vivo e a nova versão assume o controle imediatamente.
</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olá, Novo Mundo! </font><font style="vertical-align: inherit;">B)
</font></font></p>

</div>

<h2 class="sectionedit7" id="device_drivers_in_the_real_world"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drivers de dispositivo no mundo real</font></font></h2>
<div class="level2">

</div>

<h3 class="sectionedit8" id="example_3cmos_system_clock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 3: Relógio do sistema CMOS</font></font></h3>
<div class="level3">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos tentar escrever um driver de dispositivo para um componente de hardware real no seu computador, como o relógio RTC. </font><font style="vertical-align: inherit;">Este dispositivo acompanha a hora do sistema e possui uma interface de E / S muito simples. </font><font style="vertical-align: inherit;">Lembre-se da introdução de que escrever drivers de dispositivo não é apenas sobre programação, mas também sobre a compreensão do próprio hardware? </font><font style="vertical-align: inherit;">Antes de continuar, leia estes documentos sobre o RTC:
</font></font></p>
<ul>
<li class="level1"><div class="li"> <strong><a href="http://wiki.osdev.org/CMOS" class="urlextern" title="http://wiki.osdev.org/CMOS" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSDev</font></font></a> </strong></div>
</li>
<li class="level1"><div class="li"> <strong><a href="http://ivs.cs.uni-magdeburg.de/~zbrog/asm/cmos.html" class="urlextern" title="http://ivs.cs.uni-magdeburg.de/~zbrog/asm/cmos.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapa CMOS</font></font></a> </strong></div>
</li>
<li class="level1"><div class="li"> <strong><a href="http://www.freescale.com/files/microcontrollers/doc/data_sheet/MC146818.pdf" class="urlextern" title="http://www.freescale.com/files/microcontrollers/doc/data_sheet/MC146818.pdf" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MC146818 (Opcional)</font></font></a> </strong></div>
</li>
</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar modificar o driver hello que escrevemos no exemplo 2, para que possamos usar </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / time</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ler a hora atual do sistema no RTC. </font><font style="vertical-align: inherit;">Você pode reutilizar o Makefile de exemplos anteriores, se desejar. </font><font style="vertical-align: inherit;">Primeiro, crie um arquivo de cabeçalho com as definições necessárias:
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time.h</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code c"><span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#ifndef __TIME_H </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define __TIME_H</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * ID principal de / dev / time. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define TIME_MAJOR 17</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Porta de E / S básica do CMOS. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define CMOS_PORT 0x70</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Deslocamentos de campo de dados do RTC no CMOS. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#definir RTC_SECONDS 0 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_MINUTES 2 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_HOURS 4 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_DAY_OF_WEEK 6 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_DAY_OF_MONTH 7 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_MONTH 8 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_YEAR 9</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Registradores e sinalizadores RTC. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_STATUS_A 10 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_STATUS_B 11 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_UIP 0x80 </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define RTC_BCD 0x04</font></font></span><font></font>
&nbsp;<font></font>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endif / * __TIME_H * /</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora coloque este programa C em </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / src / minix / drivers / examples / time</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>

<p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time.c</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></p>
<pre class="code c"><span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdlib.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;minix / ds.h&gt; </font></font></span>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;minix / chardriver.h&gt;</font></font></span><font></font>
&nbsp;<font></font>
<span class="co2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include "time.h"</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Protótipos de função para o driver de tempo. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_open </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> access </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpoint_t user_endpt </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_close </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t menor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_read   </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição u64_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpoint_t endpt </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        cp_grant_id_t grant </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> size </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> flags </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdev_id_t id </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deslocamento </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bcd_to_bin </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não assinado </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não assinado </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_from_cmos </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Funções e variáveis ​​SEF. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_local_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vazio </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_init_info_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Pontos de entrada para o motorista do tempo. </font><font style="vertical-align: inherit;">* / </font></font></span>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora_tab do chardriver </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
        <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdr_open </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora_open </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span>
        <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdr_close </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora_close </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span>
        <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdr_read </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora_read </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_open </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> access </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpoint_t user_endpt </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"time_open () </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_close </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t menor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"time_close () </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deslocamento </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint32_t </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sys_outb </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CMOS_PORT </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deslocamento </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! =</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        panic </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"sys_outb falhou:% d" </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sys_inb </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CMOS_PORT </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! =</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        panic </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"sys_inb falhou:% d" </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bcd_to_bin </font><span class="kw4"><font style="vertical-align: inherit;">não assinado </font></span></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não assinado </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp; </font></font></span> <span class="nu12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0f </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt; </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_from_cmos </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seg </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> min </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dia </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seg </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ano </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          * Aguarde até que o sinalizador Update In Progress (UIP) esteja desmarcado, o que significa</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          * que os registros RTC estão em um estado estável.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          * / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_STATUS_A </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_UIP </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
        <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Leia a hora dos campos RTC no CMOS. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    s   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_SECONDS </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    min   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_MINUTES </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    hora </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_HOURS </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dia   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_DAY_OF_MONTH </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    mon   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_MONTH </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ano </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_YEAR </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Converter a partir de decimal codificado em binário (BCD), se necessário. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmos_read_byte </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_STATUS_B </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RTC_BCD </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        s   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bcd_to_bin </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        min   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bcd_to_bin </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> min </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        hora </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bcd_to_bin </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        dia   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bcd_to_bin </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dia </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        mon   </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bcd_to_bin </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mon </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ano </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bcd_to_bin </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ano </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Converta em uma string. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/snprintf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snprintf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"% 04d-% 02x-% 02x% 02x:% 02x:% 02x </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
             ano </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2000 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seg </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dia </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hora </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> min </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seg </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ssize_t time_read </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devminor_t minor </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> u64_t position </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpoint_t endpt </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        cp_grant_id_t grant </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> size </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> flags </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cdev_id_t id </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bytes </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ret </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer de </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span><font style="vertical-align: inherit;"></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1024 </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="st0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"time_read () </font></font><span class="es1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Recupere a hora do sistema do CMOS. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    time_from_cmos </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizeof </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    bytes </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MIN </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen</font></font></span></a><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bytes </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;= </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
        <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorne</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ret </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sys_safecopyto </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> endpt </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grant </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vir_bytes </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posição </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bytes </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ret </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! =</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bytes </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_local_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Registre retornos de chamada init. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_setcb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    sef_setcb_init_lu </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>      <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * trata as atualizações ao vivo como inits recentes * /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_setcb_init_restart </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span> <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * tratar reinicia como inits frescos * /</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Registre retornos de chamada de atualização ao vivo. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_setcb_lu_prepare </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_lu_prepare_always_ready </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>         <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * concorda em atualizar imediatamente quando uma solicitação de LU é recebida em um estado suportado * /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_setcb_lu_state_isvalid </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_lu_state_isvalid_standard </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span> <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * suporta atualização ao vivo a partir de qualquer estado padrão * /</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Deixe o SEF executar a inicialização. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_cb_init_fresh </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo </font></font><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font></span><font style="vertical-align: inherit;"></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sef_init_info_t </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Inicialize o driver de tempo. </font><font style="vertical-align: inherit;">* / </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorno </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span><font></font>
&nbsp;<font></font>
<span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> main </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> argc </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="kw4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font></span> <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">**</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> argv </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></span>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Executa a inicialização. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    sef_local_startup </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span><font></font>
&nbsp;<font></font>
    <span class="coMULTI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * Execute o loop principal. </font><font style="vertical-align: inherit;">* /</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    chardriver_task </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time_tab </font></font><span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
    <span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OK </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></span>
<span class="br0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos escrever um Makefile para descrever nosso arquivo executável e conf:
</font></font></p>
<pre class="code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Makefile para o driver de tempo.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PROG = tempo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SRCS = time.c</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ARQUIVOS = $ {PROG} .conf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FILESNAME = $ {PROG}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FILESDIR = / etc / system.conf.d</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DPADD + = $ {LIBCHARDRIVER} $ {LIBSYS}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LDADD + = -lchardriver -lsys</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.include &lt;minix.service.mk&gt;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, precisamos fornecer ao novo driver de dispositivo de hora acesso às portas CMOS 0x70 e 0x71 usando o </font><font style="vertical-align: inherit;">arquivo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time.conf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mencionado no Makefile. </font><font style="vertical-align: inherit;">Colocá-lo em /etc/system.d/ permite que o serviço o leia. </font><font style="vertical-align: inherit;">Este é o conteúdo:
</font></font></p>
<pre class="code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tempo de serviço</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    io</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        0x70: 2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        sistema</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                UMAP # 14</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DEVIO # 21</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ipc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                SISTEMA PM RS LOG TTY DS VM VFS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                pci inet amddev</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    uid 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
};</font></font><font></font>
<font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ler um byte do CMOS, um programa precisa primeiro gravar o deslocamento solicitado para ler na </font><strong><a href="http://en.wikipedia.org/wiki/Port-mapped_I/O" class="urlextern" title="http://en.wikipedia.org/wiki/Port-mapped_I/O" rel="nofollow"><font style="vertical-align: inherit;">porta de E / S</font></a></strong><font style="vertical-align: inherit;"> do endereço </font><font style="vertical-align: inherit;">, 0x70. </font><font style="vertical-align: inherit;">Em seguida, ele pode ler o byte de dados da porta de E / S 0x71. </font><font style="vertical-align: inherit;">O </font><font style="vertical-align: inherit;">driver de tempo usa esse mecanismo para ler os campos apropriados do CMOS para recuperar a hora do sistema e, em seguida, gera como uma string da mesma maneira que fizemos no exemplo 2.
</font></font><strong> <a href="http://en.wikipedia.org/wiki/Port-mapped_I/O" class="urlextern" title="http://en.wikipedia.org/wiki/Port-mapped_I/O" rel="nofollow"><font style="vertical-align: inherit;"></font></a></strong><font style="vertical-align: inherit;"></font><strong> </strong><font style="vertical-align: inherit;"></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar:
</font></font></p>
<pre class="code bash"><span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># make</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    compile time </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> time.o
        </font></font><span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   time </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font></span><span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># make install </font></font></span>
    <span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install </font></font></span>  <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> service </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font></span><span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time </font></font></span>
    <span class="kw2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install </font></font></span>  <span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> etc </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> system.conf.d </font></font><span class="sy0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font></span><span class="kw1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># serviço up / service / time -dev / dev / time </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cat / dev / time </font></font></span>
<span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -09- </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font></span> <span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21 </font></font></span>
<span class="co0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># data</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Qua </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 de</font></font></span> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setembro </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GMT </font></font><span class="nu0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014</font></font></span></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parabéns, você acabou de escrever seu primeiro driver de dispositivo real no Minix 3! </font><font style="vertical-align: inherit;">Você pode verificar se o driver lê corretamente a hora usando o </font><font style="vertical-align: inherit;">comando </font><em><font style="vertical-align: inherit;">'date (1) </font></em><strong><font style="vertical-align: inherit;">'</font></strong><font style="vertical-align: inherit;"> .
</font></font><strong> <img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/icon_smile.gif" class="icon" alt=":-)"> </strong><font style="vertical-align: inherit;"></font><strong> </strong><em><font style="vertical-align: inherit;"></font></em><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font></p>

</div>

<h3 class="sectionedit9" id="example_4rs232_serial_port"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 4: Porta serial RS232</font></font></h3>
<div class="level3">

</div>

<h2 class="sectionedit10" id="feedback"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentários</font></font></h2>
<div class="level2">

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terminou o tutorial? </font><font style="vertical-align: inherit;">Diga-nos o </font><strong><a href="http://groups.google.com/group/minix3/browse_thread/thread/aa17a4c6f891a585" class="urlextern" title="http://groups.google.com/group/minix3/browse_thread/thread/aa17a4c6f891a585" rel="nofollow"><font style="vertical-align: inherit;">que você pensa</font></a></strong><strong><font style="vertical-align: inherit;"> .</font></strong></font><strong> <img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/icon_smile.gif" class="icon" alt=":-)"> </strong><font style="vertical-align: inherit;"></font><strong> <a href="http://groups.google.com/group/minix3/browse_thread/thread/aa17a4c6f891a585" class="urlextern" title="http://groups.google.com/group/minix3/browse_thread/thread/aa17a4c6f891a585" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></strong>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developersguide / driverprogramming.txt</font></font></bdi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> · Última modificação: 24/05/2017 16:18 por </font></font><bdi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e_szabados</font></font></bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y">

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas da página</font></font></h3>
                <div class="tools">
                    <ul>
                        <li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=edit" class="action source" accesskey="v" rel="nofollow" title="Mostrar fonte da página [V]"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar fonte da página</font></font></span></a></li><li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=revisions" class="action revs" accesskey="o" rel="nofollow" title="Revisões antigas [O]"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revisões antigas</font></font></span></a></li><li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming&amp;do=backlink" class="action backlink" rel="nofollow" title="Backlinks"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backlinks</font></font></span></a></li><li class="plugin_move_page"><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renomear página</font></font></span></a></li><li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#dokuwiki__top" class="action top" accesskey="t" rel="nofollow" title="Voltar ao topo [T]"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De volta ao topo</font></font></span></a></li><li><a href="https://wiki.minix3.org/doku.php?id=developersguide:driverprogramming#" class="action copypage copypageplugin__copy" rel="nofollow"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copie esta página</font></font></span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    
    <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Doar"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/button-donate.gif" width="80" height="15" alt="Doar"></a>
        <a href="http://php.net/" title="Desenvolvido por PHP"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/button-php.gif" width="80" height="15" alt="Desenvolvido por PHP"></a>
        <a href="http://validator.w3.org/check/referer" title="HTML5 válido"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/button-html5.png" width="80" height="15" alt="HTML5 válido"></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="CSS válido"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/button-css.png" width="80" height="15" alt="CSS válido"></a>
        <a href="http://dokuwiki.org/" title="Orientado por DokuWiki"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/button-dw.png" width="80" height="15" alt="Orientado por DokuWiki"></a>
    </div>
</div></div><!-- /footer -->

<!--Start of Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29470990-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>
<!--END of Google analytics -->

    </div></div><!-- /site -->

    <div class="no"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/indexer.php" width="2" height="1" alt=""></div>
    <div id="screen__mode" class="no"></div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./Guia do desenvolvedor_ programação do driver [Wiki]_files/translate_24dp.png" width="20" height="20" alt="Google Tradutor"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Texto original</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Sugerir uma tradução melhor</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>

<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>